<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Property</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    /* ---------- tokens ---------- */
    :root{
      --card:#fff; --ink:#111; --muted:#6b7280; --brand:#111;
      --radius:14px; --gap:18px;
      --ring:32,33,36;
      --shadow-sm:0 1px 2px rgba(var(--ring), .08);
      --shadow-md:0 10px 25px rgba(var(--ring), .08), 0 2px 8px rgba(var(--ring), .06);
      --shadow-lg:0 30px 60px rgba(var(--ring), .14), 0 8px 20px rgba(var(--ring), .10);
    }

    /* ---------- base ---------- */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 600px at 20% -10%, #e9eefc 0%, transparent 60%),
        radial-gradient(1200px 600px at 100% 0%, #eaf7ff 0%, transparent 55%),
        #f6f7fb;
    }
    a{color:inherit}

    .wrap{max-width:1200px;margin:0 auto;padding:28px 18px 72px}
    .topbar{margin-bottom:12px}
    .back{display:inline-flex;gap:10px;align-items:center;text-decoration:none;color:#111}
    .back::before{content:"←";opacity:.8}
    h1{margin:8px 0 6px;font-size:32px;letter-spacing:-.02em}
    .muted{color:var(--muted)}

    .chips{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 14px}
    .chip{background:#f6f6f6;border:1px solid #ececec;padding:6px 10px;border-radius:999px;font-size:12px}

    /* ---------- layout ---------- */
    .layout{display:grid;grid-template-columns:minmax(0,1fr) 360px;gap:26px}
    @media (max-width:980px){.layout{grid-template-columns:1fr}}

    /* ---------- hero / gallery ---------- */
    .hero-card{background:var(--card);border-radius:calc(var(--radius) + 4px);overflow:hidden;box-shadow:var(--shadow-lg)}
    .hero{position:relative;aspect-ratio:16/9;background:#eee;overflow:hidden}
    .hero img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(to top, rgba(0,0,0,.18), transparent 40%);pointer-events:none}
    .gallery{display:flex;gap:10px;padding:12px 12px 16px;overflow:auto;background:linear-gradient(#fff,#fff)}
    .thumb{flex:0 0 120px;aspect-ratio:4/3;border-radius:12px;overflow:hidden;border:1px solid #eee;box-shadow:var(--shadow-sm);background:#f3f3f3;cursor:pointer;transition:transform .12s ease}
    .thumb:hover{transform:translateY(-2px)}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}

    /* ---------- sticky right column ---------- */
    .sticky{position:sticky;top:18px;align-self:start;display:flex;flex-direction:column;gap:18px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow-md);border:1px solid #edf0f3;overflow:hidden}
    .card__body{padding:16px}
    .card__title{font-size:12px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted);padding:12px 16px 8px;border-bottom:1px solid #f0f2f5;background:linear-gradient(#fff,#fff)}
    .actions{display:flex;gap:10px;margin-bottom:12px}
    .btn{height:44px;padding:0 16px;border-radius:10px;border:none;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;font-weight:600;text-decoration:none;box-shadow:var(--shadow-sm)}
    .btn-primary{background:var(--brand);color:#fff}
    .btn-ghost{background:#fff;border:1px solid #e6e6e6}
    #map{height:260px;border-radius:12px;overflow:hidden;box-shadow:var(--shadow-sm)}

    /* ---------- facts grid ---------- */
    .facts{display:grid;gap:14px;grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:700px){.facts{grid-template-columns:1fr}}
    .fact{background:#fff;border:1px solid #eef0f3;border-radius:12px;padding:14px;box-shadow:var(--shadow-sm)}
    .fact .label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.05em;margin-bottom:6px}
    .fact .value{font-weight:600}

    /* ---------- sections ---------- */
    .section{margin-top:22px}
    .section .card__title{display:flex;align-items:center;gap:8px}
    .section h2{font-size:18px;margin:0;letter-spacing:-.01em}
    .features{margin:10px 0 2px;padding-left:20px}
    .features li{margin:6px 0}

    /* ---------- agents ---------- */
    .agent{display:grid;grid-template-columns:48px 1fr;gap:12px;align-items:center;padding:12px 16px;border-top:1px solid #f0f2f5}
    .agent:first-of-type{border-top:none}
    .avatar{width:48px;height:48px;border-radius:50%;overflow:hidden;display:grid;place-items:center;background:#f1f3f6;color:#222;font-weight:700;border:1px solid #e9edf2}
    .avatar img{width:100%;height:100%;object-fit:cover;display:block}
    .agent .name{font-weight:600}
    .agent .meta{font-size:13px;color:var(--muted)}
    .agent .cta{margin-top:6px;display:flex;gap:10px;flex-wrap:wrap}
    .agent .cta a{font-size:13px;text-decoration:underline}

    /* ---------- enquiry modal ---------- */
    .modal{position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.35);z-index:9999;padding:20px}
    .modal[hidden]{display:none}
    .modal__card{
      width:min(860px, 100%);
      background:#fff;border-radius:14px;box-shadow:0 30px 60px rgba(0,0,0,.18);
      overflow:hidden; animation:pop .12s ease;
    }
    @keyframes pop{from{transform:scale(.98);opacity:.7}to{transform:scale(1);opacity:1}}
    .modal__head{padding:16px 18px;border-bottom:1px solid #eef0f3;display:flex;align-items:center;justify-content:space-between}
    .modal__title{margin:0;font-size:18px;letter-spacing:-.01em}
    .modal__close{border:none;background:transparent;font-size:22px;line-height:1;cursor:pointer}
    .modal__body{padding:16px 18px}
    .contactRow{display:flex;gap:18px;flex-wrap:wrap;margin-bottom:12px}
    .agentBadge{display:grid;grid-template-columns:48px 1fr;gap:10px;align-items:center;padding:10px 12px;border:1px solid #edf0f3;border-radius:12px}
    .agentBadge .avatar{width:48px;height:48px;border-radius:50%;overflow:hidden;display:grid;place-items:center;background:#f1f3f6;font-weight:700}
    .agentBadge .avatar img{width:100%;height:100%;object-fit:cover;display:block}
    .formGrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media (max-width:680px){.formGrid{grid-template-columns:1fr}}
    .input, .textarea, .select{width:100%;height:44px;padding:10px 12px;border-radius:10px;border:1px solid #dcdcdc;font-size:14px;background:#fff}
    .textarea{height:auto;min-height:90px;resize:vertical}
    .formRow{margin:10px 0}
    .actionsRow{display:flex;gap:10px;justify-content:flex-end;border-top:1px solid #eef0f3;padding:12px 0 0;margin-top:14px}
    .btn-solid{height:44px;padding:0 16px;border-radius:10px;border:none;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;font-weight:600;background:#111;color:#fff}
    .btn-ghost2{height:44px;padding:0 16px;border-radius:10px;border:1px solid #e6e6e6;background:#fff;cursor:pointer}
    .note{color:#6b7280;font-size:12px}
    .successBox{background:#f3faf4;border:1px solid #d6f0da;padding:12px;border-radius:10px;margin-top:10px}
    .errorBox{background:#fff5f5;border:1px solid #ffd7d7;padding:12px;border-radius:10px;margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <a class="back" href="index.html">Back to results</a>
    </div>

    <div id="loading" class="muted">Loading…</div>

    <div id="content" style="display:none">
      <h1 id="prop-title">Property</h1>
      <div class="muted" id="prop-sub"></div>
      <div class="chips" id="prop-chips"></div>

      <div class="layout">
        <!-- LEFT -->
        <div>
          <div class="hero-card">
            <div class="hero" id="hero"></div>
            <div class="gallery" id="thumbs"></div>
          </div>

          <!-- Facts -->
          <div class="section">
            <div class="card">
              <div class="card__title">Key details</div>
              <div class="card__body"><div class="facts" id="facts"></div></div>
            </div>
          </div>

          <!-- Overview -->
          <div class="section" id="overviewCard" style="display:none">
            <div class="card">
              <div class="card__title"><h2>Overview</h2></div>
              <div class="card__body" id="overview"></div>
            </div>
          </div>

          <!-- Features -->
          <div class="section" id="featuresCard" style="display:none">
            <div class="card">
              <div class="card__title"><h2>Key features</h2></div>
              <div class="card__body"><ul class="features" id="features"></ul></div>
            </div>
          </div>

          <!-- Description -->
          <div class="section" id="descCard" style="display:none">
            <div class="card">
              <div class="card__title"><h2>Description</h2></div>
              <div class="card__body" id="desc"></div>
            </div>
          </div>

          <!-- Location -->
          <div class="section" id="locCard" style="display:none">
            <div class="card">
              <div class="card__title"><h2>Location</h2></div>
              <div class="card__body" id="loc"></div>
            </div>
          </div>

          <!-- Optional: Transport -->
          <div class="section" id="transportCard" style="display:none">
            <div class="card">
              <div class="card__title"><h2>Transport</h2></div>
              <div class="card__body" id="transport"></div>
            </div>
          </div>
        </div>

        <!-- RIGHT (sticky) -->
        <aside class="sticky">
          <div class="card">
            <div class="card__title">Enquire about this property</div>
            <div class="card__body">
              <div class="actions">
                <a class="btn btn-primary" id="enquireBtn">Enquire now</a>
                <a class="btn btn-ghost" id="brochureBtn" target="_blank" rel="noopener">Download brochure</a>
              </div>
              <div id="map"></div>
            </div>
          </div>

          <div class="card" id="teamBox" style="display:none">
            <div class="card__title">Viewings & further information</div>
            <div id="agents"></div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <!-- Enquiry Modal -->
  <div id="enquireModal" class="modal" hidden>
    <div class="modal__card" role="dialog" aria-modal="true" aria-labelledby="enqTitle">
      <div class="modal__head">
        <h3 id="enqTitle" class="modal__title">Enquire now</h3>
        <button class="modal__close" type="button" aria-label="Close" id="enqClose">×</button>
      </div>
      <div class="modal__body">
        <div class="contactRow" id="enqAgents"></div>

        <form id="enquiryForm">
          <!-- Hidden property context -->
          <input type="hidden" name="property_id" id="enqPropId">
          <input type="hidden" name="property_address" id="enqPropAddr">
          <input type="hidden" name="property_url" id="enqPropUrl">
          <input type="hidden" name="brochure_url" id="enqBrochureUrl">

          <div class="formGrid">
            <div class="formRow">
              <label>Title
                <select class="select" name="title">
                  <option value="">—</option><option>Mr</option><option>Mrs</option><option>Ms</option><option>Dr</option>
                </select>
              </label>
            </div>
            <div class="formRow"></div>

            <div class="formRow">
              <label>First name*
                <input class="input" name="first_name" required>
              </label>
            </div>
            <div class="formRow">
              <label>Last name*
                <input class="input" name="last_name" required>
              </label>
            </div>

            <div class="formRow">
              <label>Email*
                <input class="input" type="email" name="email" required>
              </label>
            </div>
            <div class="formRow">
              <label>Phone
                <input class="input" name="phone">
              </label>
            </div>

            <div class="formRow">
              <label>Company
                <input class="input" name="company">
              </label>
            </div>
            <div class="formRow">
              <label>Job title
                <input class="input" name="job_title">
              </label>
            </div>

            <div class="formRow" style="grid-column:1/-1">
              <label>Message
                <textarea class="textarea" name="message" placeholder="Tell us a bit about your requirement"></textarea>
              </label>
            </div>

            <div class="formRow" style="grid-column:1/-1">
              <label style="display:flex;gap:8px;align-items:center">
                <input type="checkbox" name="optin"> <span class="note">Add me to your mailing list</span>
              </label>
            </div>
          </div>

          <div id="enqNotice" class="note" style="margin-top:6px"></div>
          <div id="enqSuccess" class="successBox" hidden>Thanks — your enquiry has been sent.</div>
          <div id="enqError" class="errorBox" hidden>Sorry, something went wrong. You can still email us directly using the button below.</div>

          <div class="actionsRow">
            <button type="button" class="btn-ghost2" id="enqCancel">Cancel</button>
            <a id="enqFallback" class="btn-ghost2" href="#">Email instead</a>
            <button type="submit" class="btn-solid" id="enqSubmit">Send enquiry</button>
          </div>
        </form>
      </div>
    </div>
  </div>

<script>
/* ---------- helpers ---------- */
const $  = (s, el=document) => el.querySelector(s);
function getParam(name){ return new URLSearchParams(location.search).get(name); }
function pick(...vals){ return vals.find(v => v !== undefined && v !== null && v !== ''); }
function initials(name){ if(!name) return ""; return String(name).trim().split(/\s+/).slice(0,2).map(w=>w[0]?.toUpperCase()||"").join(""); }

function getImages(p){
  const arr=[];
  if (Array.isArray(p.images)) {
    for (const it of p.images) {
      if (typeof it === 'string') arr.push(it);
      else if (it?.url) arr.push(it.url);
      else if (it?._) arr.push(it._);
    }
  }
  if (!arr.length && Array.isArray(p.photos)) for (const ph of p.photos) if (ph?.url) arr.push(ph.url);
  const fallback = pick(p.image, p.image_url);
  if (fallback) arr.unshift(fallback);
  return [...new Set(arr)].filter(Boolean);
}
function toListItems(val){
  if (!val) return [];
  if (Array.isArray(val)) return val.map(String).filter(Boolean);
  return String(val).split(/\r?\n|•/g).map(s => s.trim()).filter(Boolean);
}
function formatSize(p){
  const a=p.size_from_sqft, b=p.size_to_sqft;
  if (a && b) return `${a}–${b} sq ft`;
  if (a) return `${a} sq ft`;
  if (b) return `${b} sq ft`;
  return '';
}
function buildEnquiryUrl(p){
  const to = "gjs-dillon-limited-393@parse.agents-society.com";
  const subject = `Enquiry: ${p.address || 'Property'} (${p.id ?? ''})`;
  const body = [
    "Hi,",
    "",
    "I'd like more information about:",
    `${p.address || 'Property'}`,
    `${[p.town, p.postcode].filter(Boolean).join(' ')}`,
    `Ref: ${p.id ?? ''}`,
    "",
    "Please reply to me via email/phone."
  ].join("\n");
  return `mailto:${to}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}

/* ---------- enquiry (modal) config ---------- */
const ENQUIRY_ENDPOINT = "https://formspree.io/f/your_form_id"; // <-- REPLACE with your Formspree endpoint
let CURRENT_PROPERTY = null;

function showModal(){ $('#enquireModal').hidden = false; document.body.style.overflow='hidden'; }
function hideModal(){ $('#enquireModal').hidden = true; document.body.style.overflow=''; }
function agentBadge(c){
  const photo = c.photo || c.image || "";
  const init  = initials(c.name || "");
  const tel   = c.tel || c.phone || "";
  const mob   = c.mobile ? String(c.mobile) : "";
  return `
    <div class="agentBadge">
      <div class="avatar">
        ${photo ? `<img src="${photo}" alt="">` : `${init}`}
      </div>
      <div>
        <div style="font-weight:600">${c.name || ''}</div>
        <div class="note">${[tel, mob].filter(Boolean).join(' • ')}</div>
      </div>
    </div>`;
}

/* ---------- page ---------- */
let map, marker;

async function main(){
  const id = getParam('id');
  const res = await fetch('./properties.json', { cache:'no-store' });
  const list = await res.json();
  const items = list.map((p,i)=>({ id: p.id ?? p.slug ?? p.uid ?? i, ...p }));
  const p = items.find(x => String(x.id) === String(id)) || items[0];
  CURRENT_PROPERTY = p;

  if (!p){ $('#loading').textContent = 'Property not found.'; return; }

  document.title = p.address ? `${p.address} — Property` : 'Property';
  $('#loading').style.display = 'none';
  $('#content').style.display = '';

  /* header */
  $('#prop-title').textContent = p.address || 'Property';
  $('#prop-sub').textContent = [p.town, p.postcode].filter(Boolean).join(' ');
  const chips = $('#prop-chips');
  const tType  = pick(p.type, p.property_type, Array.isArray(p.types)&&p.types[0]);
  const tenure = pick(p.tenure, p.transaction_type, p.to_let ? 'To Let' : (p.for_sale ? 'For Sale' : ''));
  const epcObj = p.current_energy_ratings?.rating;
  const epc    = pick(p.epc_rating, p.epc, epcObj ? `${epcObj._ || epcObj} (${epcObj?.$?.value || ""})` : "");
  if (tenure) chips.innerHTML += `<span class="chip">${tenure}</span>`;
  if (tType)  chips.innerHTML += `<span class="chip">${tType}</span>`;
  if (epc)    chips.innerHTML += `<span class="chip">EPC ${epc}</span>`;

  /* gallery */
  const imgs = getImages(p);
  const hero = $('#hero'); const thumbs = $('#thumbs');
  const setHero = (src) => { hero.innerHTML = src ? `<img src="${src}" alt="${p.address||'Property'}">` : ''; };
  setHero(imgs[0] || '');
  thumbs.innerHTML = imgs.slice(0,15).map(u => `<button class="thumb" type="button" data-src="${u}" aria-label="View photo"><img src="${u}" alt=""></button>`).join('');
  thumbs.addEventListener('click', e => {
    const t = e.target.closest('.thumb'); if (!t) return;
    setHero(t.dataset.src);
    thumbs.scrollTo({ left: t.offsetLeft - 12, behavior:'smooth' });
  });

  /* facts */
  const facts = $('#facts');
  const fact = (label, value) => value ? `<div class="fact"><div class="label">${label}</div><div class="value">${value}</div></div>` : '';
  const ratesPay = p.business_rates?.rates_payable ? `${p.business_rates.rates_payable} per sq ft` : p.business_rates_psf || '';
  const rv = p.business_rates?.rateable_value ? `£${Number(p.business_rates.rateable_value).toLocaleString()}` : p.rateable_value || '';
  facts.innerHTML = [
    fact('Property type', tType),
    fact('Tenure', tenure),
    fact('Size', formatSize(p)),
    fact('Rent', pick(p.rent, p.rent_psf)),
    fact('Business rates', ratesPay),
    fact('Rateable value', rv),
    fact('EPC', epc),
    fact('Last updated', p.last_updated || '')
  ].join('');

  /* text blocks */
  const overview = pick(p.specification_summary?._, p.summary);
  if (overview){ $('#overview').innerHTML = overview; $('#overviewCard').style.display=''; }

  const feats = toListItems(p.key_selling_points?.key_selling_point || p.features || p.key_features);
  if (feats.length){ $('#features').innerHTML = feats.map(f=>`<li>${f}</li>`).join(''); $('#featuresCard').style.display=''; }

  const desc = pick(p.specification_description?._, p.description);
  if (desc){ $('#desc').innerHTML = desc; $('#descCard').style.display=''; }

  const loc = pick(p.location?._, p.location);
  if (loc){ $('#loc').innerHTML = loc; $('#locCard').style.display=''; }

  // Optional Transport block if feed provides marketing_text_transport
  const transport = pick(p.marketing_text_transport?._, p.marketing_text_transport);
  if (transport){ $('#transport').innerHTML = transport; $('#transportCard').style.display=''; }

  /* actions (modal-enabled) */
  const brochure = pick(p.brochure, p.brochure_url, p.files?.file?.url);
  const enquireBtn = $('#enquireBtn');
  enquireBtn.href = '#';
  enquireBtn.addEventListener('click', (e) => {
    e.preventDefault();

    // agents at top of modal
    const contacts = Array.isArray(p.contacts?.contact) ? p.contacts.contact
                   : Array.isArray(p.contacts) ? p.contacts
                   : p.contacts ? [p.contacts] : [];
    $('#enqAgents').innerHTML = contacts.slice(0,2).map(agentBadge).join('');

    // Prefill hidden fields
    $('#enqPropId').value   = p.id ?? '';
    $('#enqPropAddr').value = p.address || '';
    $('#enqPropUrl').value  = location.href;
    $('#enqBrochureUrl').value = brochure || '';

    // Fallback mailto
    $('#enqFallback').href = buildEnquiryUrl(p);

    // Notice text
    $('#enqNotice').textContent = `Enquiry about “${p.address || 'Property'}” ${[p.town, p.postcode].filter(Boolean).join(' ')}`;

    // Reset state
    $('#enqSuccess').hidden = true;
    $('#enqError').hidden = true;
    $('#enqSubmit').disabled = false;

    showModal();
  });

  if (brochure){ $('#brochureBtn').href = brochure; $('#brochureBtn').style.display='inline-flex'; }
  else { $('#brochureBtn').style.display='none'; }

  /* map */
  map = L.map('map', { zoomControl:true }).setView([52.5,-1.8], 6);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  const lat = Number(p.lat), lon = Number(p.lon);
  if (isFinite(lat) && isFinite(lon)){
    marker = L.circleMarker([lat, lon], { radius:7, weight:2, color:'#111', fillColor:'#111', fillOpacity:.85 }).addTo(map);
    map.setView([lat, lon], 14);
  }

  /* agents list on page */
  const contacts = Array.isArray(p.contacts?.contact) ? p.contacts.contact
                 : Array.isArray(p.contacts) ? p.contacts
                 : p.contacts ? [p.contacts] : [];
  if (contacts.length){
    const list = $('#agents');
    list.innerHTML = contacts.map(c => {
      const photo = c.photo || c.image || '';
      const init  = initials(c.name || '');
      const tel   = c.tel || c.phone || '';
      const mob   = c.mobile ? String(c.mobile) : '';
      return `
        <div class="agent">
          <div class="avatar">
            ${photo ? `<img src="${photo}" alt="${c.name||'Agent'}" onerror="this.closest('.avatar').textContent='${init}'">` : `${init}`}
          </div>
          <div>
            <div class="name">${c.name || ''}</div>
            <div class="meta">${[c.office, c.branch].filter(Boolean).join(' • ')}</div>
            <div class="meta">${[tel, mob].filter(Boolean).join(' • ')}</div>
            <div class="cta">
              ${c.email ? `<a href="mailto:${c.email}">Email</a>` : ''}
              ${tel ? `<a href="tel:${tel}">Call</a>` : ''}
              ${mob ? `<a href="tel:${mob}">Mobile</a>` : ''}
            </div>
          </div>
        </div>
      `;
    }).join('');
    $('#teamBox').style.display = '';
  }
}

main();

/* ---------- modal controls & submit ---------- */
$('#enqClose').addEventListener('click', hideModal);
$('#enqCancel').addEventListener('click', hideModal);
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && !$('#enquireModal').hidden) hideModal(); });

$('#enquiryForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const btn = $('#enqSubmit');
  btn.disabled = true;
  $('#enqSuccess').hidden = true;
  $('#enqError').hidden = true;

  try{
    const fd = new FormData(e.target);
    const subject = `Enquiry: ${(CURRENT_PROPERTY?.address || 'Property')} (${CURRENT_PROPERTY?.id ?? ''})`;
    fd.append('_subject', subject);

    const res = await fetch(ENQUIRY_ENDPOINT, {
      method: 'POST',
      body: fd,
      headers: { 'Accept': 'application/json' }
    });

    if(res.ok){
      $('#enqSuccess').hidden = false;
      e.target.querySelectorAll('input:not([type="hidden"]):not([type="checkbox"]), textarea')
              .forEach(el => el.value = '');
    }else{
      $('#enqError').hidden = false;
      btn.disabled = false;
    }
  }catch(err){
    console.error(err);
    $('#enqError').hidden = false;
    btn.disabled = false;
  }
});
</script>
</body>
</html>
